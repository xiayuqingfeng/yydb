<%@ page language="java" pageEncoding="UTF-8"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="X-UA-Compatible" content="IE=Edge"> <%@ include file="../wap/commons/commons_resource_head.jsp"%> <title>更新头像_${comName}</title> <meta charset="utf-8">  <meta name="keywords" content="" />  <meta name="description" content="" />  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2,user-scalable=no">   <link rel="stylesheet" href="${wapBase}/style/mobile/css/common.css">    <link rel="stylesheet" href="${wapBase}/style/mobile/css/font/iconfont.css">     <script src="${wapBase}/style/jquery-1.8.3.min.js"></script>     <script type="text/javascript" src="${wapBase}/style/layer/layer.min.js"></script>     <script type="text/javascript" src="${wapBase}/style/common.js"></script></head><body> <header id="header2"> <h1>更新头像</h1> <div class="back">  <a class="ap-icon" href="javascript:history.back();"></a> </div> <div class="menu">  <a class="icon-home ap-icon" href="/"></a> </div> </header> <link rel="stylesheet" href="${wapBase}/style/mobile/css/member.css">  <style type="text/css">.container {	background: #fff;}.button-box {	padding: 10px 0 35px;}.btn-db a {	background: #E54048;}.webuploader-pick {	padding: 0 10px !important;	margin: 0 5px !important;	display: block !important;	font-size: 1.6rem !important;	border-radius: 8px;}.btns {	display: block !important;}.btn-db button {	display: block;	margin: 0 5px;	height: 35px;	line-height: 35px;	width: 95%;	text-align: center;	background: #e54048;	font-size: 1.6rem;	border: 0;	border-radius: 8px;	color: #fff;}.uploader-list {	padding-left: 10px;}/*图片层*/#photo_box {	margin-top: 10px;	text-align: center;	position: relative;}#photo_box dd {	height: 160px;	overflow: hidden;}#photo {	display: none;}#photo_left {	position: absolute;	top: 0;	height: 160px;	background-color: rgba(0, 0, 0, 0.5);}#photo_center {	position: absolute;	top: 0;	border: 1px dotted #ccc;	width: 158px;	height: 158px;	background-color: rgba(0, 0, 0, 0.0);}#photo_right {	position: absolute;	top: 0;	height: 160px;	background-color: rgba(0, 0, 0, 0.5);}</style>  <script type="text/javascript">			var photo = 1;			$(function() {				//获取遮罩层位置				var cw = $('#photo_box dd').width();				var ch = $('#photo_box dd').height();				var w = $('#photo').width();				var h = $('#photo').height();				$('#photo_center').css({					left : (cw - w) / 2 + (w - 160) / 2				})				$('#photo_left').css({					width : (cw - 160) / 2 + 1,					left : 0				});				$('#photo_right').css({					width : (cw - 160) / 2,					left : (cw - 160) / 2 + 160				});				loadPhoto();			})			//保证图片居中，重新计算图片位置			function loadPhoto() {				var theImage = new Image();				theImage.src = $('#photo').attr('src');				var w = theImage.width;				var h = theImage.height;				if (w > h) {					$('#photo').css({						width : 'auto',						height : 160					});				} else if (h > w) {					h = h / w * 160;					$('#photo').css({						width : 160,						height : h					}).css('margin-top', '-' + (h - 160) / 2 + 'px');				} else {					$('#photo').css({						width : 160,						height : 160					});				}				$('#photo').show();			}		</script>  <div id="content" class="container main">   <div class="tips-m">    <ul>     <li>      <dl class="prompt">       <dt style="font-weight: bold;">        <p>将自动剪裁出160*160尺寸的头像；</p>        <p>上传的图片大小请限制在2M以内。</p>       </dt>      </dl>     </li>    </ul>   </div>   <dl id="photo_box">    <dt id="photo_left"></dt>    <dt id="photo_center"></dt>    <dt id="photo_right"></dt>    <dd>     <c:choose>      <c:when test="${empty user.headPhotoPath }">       <img id="photo" src="${wapBase}/upload/images/photo/20160908021501520630846_src_80.jpg.png" />      </c:when>      <c:otherwise>       <img id="photo" src="${user.headPhotoPath }" />      </c:otherwise>     </c:choose>    </dd>   </dl>   <form action="/member/photo" target="iframeNews" method="post">    <div class="button-box ui-clr">     <span class="btn-db">      <link rel="stylesheet" type="text/css" href="${wapBase}/style/webuploader/webuploader.css">       <script type="text/javascript" src="${wapBase}/style/webuploader/webuploader.js"></script>       <div id="uploader_photo" class="wu-example">        <div class="btns">         <div id="pickerphoto">选择图片</div>        </div>        <input type='hidden' name='photo' value='' /> <img src="/style/swf_up/img.jpg" class="showimg" id="photo"         style="vertical-align: top; margin-top: 3px; margin-left: 10px; display: none;" />        <!--用来存放文件信息-->        <div id="thelistphoto" class="uploader-list"></div>       </div>       <script type="text/javascript">								$(function() {									var $ = jQuery, $list = $('#thelistphoto'), $btn = $('#ctlBtnphoto'), state = 'pending', uploader;									var uploader = WebUploader.create({										swf : '${wapBase}/style/webuploader/Uploader.swf',										server : '/img/uploadFile',										pick : '#pickerphoto',										resize : false,										fileNumLimit : 1,										formData : {											'dir' : 'photo',											'width' : '0',											'height' : '0'										},										chunked : true,										fileSizeLimit : 20 * 1024 * 1024,										auto : true,										sendAsBinary : false,										accept : {											extensions : 'gif,jpg,jpeg,png',											mimeTypes : 'image/*'										}									})									// 当有文件添加进来的时候									uploader.on('fileQueued', function(file) {										$list.append('<div id="' + file.id + '">' + '<b class="info">' + file.name + '</b>' + '<span class="state">等待上传...</span>'												+ '</div>');									});									// 文件上传过程中创建进度条实时显示。									uploader.on('uploadProgress', function(file, percentage) {										var $li = $('#' + file.id), $percent = $li.find('.progress .progress-bar');										// 避免重复创建										if (!$percent.length) {											$percent = $(													'<div class="progress progress-striped active">' + '<div class="progress-bar" role="progressbar" style="width: 0%">'															+ '</div>' + '</div>').appendTo($li).find('.progress-bar');										}										$li.find('.state').text('上传中');										$percent.css('width', percentage * 100 + '%');									});									uploader.on('uploadSuccess', function(file, response) {										$('#' + file.id).find('.state').text('已上传');										//alert(response.data);										$('input[name=photo]').val(response.data);										$('#photo').attr('src', ""+response.data).load(function() {											if (photo) {												loadPhoto();											}										});									});									uploader.on('uploadError', function(file) {										$('#' + file.id).find('.state').text('上传出错');									});									uploader.on('uploadComplete', function(file) {										$('#' + file.id).find('.progress').fadeOut();									});									uploader.on('all', function(type) {										if (type === 'startUpload') {											state = 'uploading';										} else if (type === 'stopUpload') {											state = 'paused';										} else if (type === 'uploadFinished') {											state = 'done';										}										if (state === 'uploading') {											$btn.text('暂停上传');										} else {											$btn.text('开始上传');										}									});									$btn.on('click', function() {										if (state === 'uploading') {											uploader.stop();										} else {											uploader.upload();										}									});								});							</script>     </span> <span class="btn-db">      <button type="submit" name="Submit">上传图片</button>     </span>    </div>   </form>  </div>  <!--  公共底部 -->  <c:set var="footType" value="member" />    <%@ include file="../wap/index/index_foot.jsp"%>  <!--  公共底部 --></body></html>